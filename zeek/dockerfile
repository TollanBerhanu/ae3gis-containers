FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

# Install essential dependencies
RUN apt-get update && apt-get install -y \
    curl gnupg ca-certificates \
    software-properties-common \
    openssh-server sudo rsyslog net-tools iproute2 iputils-ping \
    tcpdump nano vim

# Add Zeek repository for Ubuntu 22.04
RUN echo 'deb http://download.opensuse.org/repositories/security:/zeek/xUbuntu_22.04/ /' \
    | tee /etc/apt/sources.list.d/security:zeek.list \
    && curl -fsSL https://download.opensuse.org/repositories/security:zeek/xUbuntu_22.04/Release.key \
    | gpg --dearmor | tee /etc/apt/trusted.gpg.d/zeek_oss_repo.gpg > /dev/null

# Install Zeek from the repository
RUN apt-get update && apt-get install -y \
    zeek-6.0 \
    zeek-6.0-core \
    zeekctl-6.0

# Add Zeek to PATH (Zeek installs under /opt/zeekâ€‘6.0)
ENV PATH="/opt/zeek/bin:$PATH"

# Configure SSH
RUN mkdir /var/run/sshd \
    && echo 'root:pass' | chpasswd \
    && sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# Enable IPv4 forwarding
RUN echo 'net.ipv4.ip_forward=1' >> /etc/sysctl.conf

EXPOSE 22

CMD ["sh", "-c", "service rsyslog start && service ssh start && bash"]
